
(function(b){var a={annotations:[],f2:function(c){return c.toFixed(2)},notEmpty:function(c){if(typeof c!="undefined"){if(c!=""){return true}}}};jsPDF.API.annotationPlugin=a;jsPDF.API.events.push(["addPage",function(c){this.annotationPlugin.annotations[c.pageNumber]=[]}]);b.events.push(["putPage",function(r){var o=this.annotationPlugin.annotations[r.pageNumber];var l=false;for(var t=0;t<o.length&&!l;t++){var f=o[t];switch(f.type){case"link":if(a.notEmpty(f.options.url)||a.notEmpty(f.options.pageNumber)){l=true;break}case"reference":case"text":case"freetext":l=true;break}}if(l==false){return}this.internal.write("/Annots [");var n=this.annotationPlugin.f2;var p=this.internal.scaleFactor;var i=this.internal.pageSize.height;var d=this.internal.getPageInfo(r.pageNumber);for(var t=0;t<o.length;t++){var f=o[t];switch(f.type){case"reference":this.internal.write(" "+f.object.objId+" 0 R ");break;case"text":var u=this.internal.newAdditionalObject();var e=this.internal.newAdditionalObject();var v=f.title||"Note";var c="/Rect ["+n(f.bounds.x*p)+" "+n(i-(f.bounds.y+f.bounds.h)*p)+" "+n((f.bounds.x+f.bounds.w)*p)+" "+n((i-f.bounds.y)*p)+"] ";j="<</Type /Annot /Subtype /Text "+c+"/Contents ("+f.contents+")";j+=" /Popup "+e.objId+" 0 R";j+=" /P "+d.objId+" 0 R";j+=" /T ("+v+") >>";u.content=j;var g=u.objId+" 0 R";var s=30;var c="/Rect ["+n((f.bounds.x+s)*p)+" "+n(i-(f.bounds.y+f.bounds.h)*p)+" "+n((f.bounds.x+f.bounds.w+s)*p)+" "+n((i-f.bounds.y)*p)+"] ";j="<</Type /Annot /Subtype /Popup "+c+" /Parent "+g;if(f.open){j+=" /Open true"}j+=" >>";e.content=j;this.internal.write(u.objId,"0 R",e.objId,"0 R");break;case"freetext":var c="/Rect ["+n(f.bounds.x*p)+" "+n((i-f.bounds.y)*p)+" "+n(f.bounds.x+f.bounds.w*p)+" "+n(i-(f.bounds.y+f.bounds.h)*p)+"] ";var q=f.color||"#000000";j="<</Type /Annot /Subtype /FreeText "+c+"/Contents ("+f.contents+")";j+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+q+")";j+=" /Border [0 0 0]";j+=" >>";this.internal.write(j);break;case"link":if(f.options.name){var h=this.annotations._nameMap[f.options.name];f.options.pageNumber=h.page;f.options.top=h.y}else{if(!f.options.top){f.options.top=0}}var c="/Rect ["+n(f.x*p)+" "+n((i-f.y)*p)+" "+n((f.x+f.w)*p)+" "+n((i-(f.y+f.h))*p)+"] ";var j="";if(f.options.url){j="<</Type /Annot /Subtype /Link "+c+"/Border [0 0 0] /A <</S /URI /URI ("+f.options.url+") >>"}else{if(f.options.pageNumber){var r=this.internal.getPageInfo(f.options.pageNumber);j="<</Type /Annot /Subtype /Link "+c+"/Border [0 0 0] /Dest ["+r.objId+" 0 R";f.options.magFactor=f.options.magFactor||"XYZ";switch(f.options.magFactor){case"Fit":j+=" /Fit]";break;case"FitH":j+=" /FitH "+f.options.top+"]";break;case"FitV":f.options.left=f.options.left||0;j+=" /FitV "+f.options.left+"]";break;case"XYZ":default:var m=n((i-f.options.top)*p);f.options.left=f.options.left||0;if(typeof f.options.zoom==="undefined"){f.options.zoom=0}j+=" /XYZ "+f.options.left+" "+m+" "+f.options.zoom+"]";break}}else{}}if(j!=""){j+=" >>";this.internal.write(j)}break}}this.internal.write("]")}]);b.createAnnotation=function(c){switch(c.type){case"link":this.link(c.bounds.x,c.bounds.y,c.bounds.w,c.bounds.h,c);break;case"text":case"freetext":this.annotationPlugin.annotations[this.internal.getCurrentPageInfo().pageNumber].push(c);break}};b.link=function(c,g,d,f,e){this.annotationPlugin.annotations[this.internal.getCurrentPageInfo().pageNumber].push({x:c,y:g,w:d,h:f,options:e,type:"link"})};b.textWithLink=function(g,d,h,e){var f=this.getTextWidth(g);var c=this.internal.getLineHeight()/this.internal.scaleFactor;this.text(g,d,h);h+=c*0.2;this.link(d,h-c,f,c,e);return f};b.getTextWidth=function(e){var d=this.internal.getFontSize();var c=this.getStringUnitWidth(e)*d/this.internal.scaleFactor;return c};b.getLineHeight=function(){return this.internal.getLineHeight()};return this})(jsPDF.API);